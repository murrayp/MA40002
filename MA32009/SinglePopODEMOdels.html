<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Continuous time, single species population dynamics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="SinglePopODEMOdels_files/libs/clipboard/clipboard.min.js"></script>
<script src="SinglePopODEMOdels_files/libs/quarto-html/quarto.js"></script>
<script src="SinglePopODEMOdels_files/libs/quarto-html/popper.min.js"></script>
<script src="SinglePopODEMOdels_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SinglePopODEMOdels_files/libs/quarto-html/anchor.min.js"></script>
<link href="SinglePopODEMOdels_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SinglePopODEMOdels_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SinglePopODEMOdels_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SinglePopODEMOdels_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SinglePopODEMOdels_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Continuous time, single species population dynamics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this section we define time, <span class="math inline">\(t\)</span>, to be a continuous variable and the population density, <span class="math inline">\(N(t)\)</span>, to represent the size of a given population.</p>
<section id="a-general-model" class="level2">
<h2 class="anchored" data-anchor-id="a-general-model">A general model</h2>
<section id="a-qualitative-analysis" class="level3">
<h3 class="anchored" data-anchor-id="a-qualitative-analysis">A qualitative analysis</h3>
<p>Employing ordinary differential equations, we consider equations of the form <span id="eq-GenSingleSpecODE"><span class="math display">\[
\frac{dN}{dt}=f(N)N=H(N).
\tag{1}\]</span></span> where <span class="math inline">\(f\)</span> is the per capita growth rate and <span class="math inline">\(H\)</span> is the net growth rate.</p>
</section>
<section id="the-malthusian-linear-model" class="level3">
<h3 class="anchored" data-anchor-id="the-malthusian-linear-model">The Malthusian (linear) model</h3>
<section id="deriving-a-linear-model" class="level4">
<h4 class="anchored" data-anchor-id="deriving-a-linear-model">Deriving a linear model</h4>
<p>As time is now a continuous variable, we consider an interval of time <span class="math inline">\(\delta t\)</span>. Consider a population of size <span class="math inline">\(N(t)\)</span>. If the per capita production rate is <span class="math inline">\(b\)</span>, then in time <span class="math inline">\(\delta t\)</span> the increase in population size will be <span class="math display">\[
b N(t) \delta t.
\]</span> Similarly, if the per capita death rate is <span class="math inline">\(d\)</span>, the decrease in population size in time <span class="math inline">\(\delta t\)</span> will be <span class="math display">\[
d N(t) \delta t.
\]</span> Hence <span class="math display">\[
N(t+\delta t)= N(t) + (bN(t)-dN(t))\delta t.
\]</span> Rearranging and taking the limit as <span class="math inline">\(\delta t \rightarrow 0\)</span> yields <span class="math display">\[
\frac{dN}{dt}=(b-d)N=rN(t).
\]</span> The solution is given by <span class="math display">\[
N(t)=N_0\exp(rt).
\]</span></p>
<p>We can describe qualitatively different solutions behaviours.</p>
<p>If <span class="math inline">\(r&gt;0\)</span> the solution increases exponentially with time. If <span class="math inline">\(r&lt;0\)</span> it decreases exponentially. When <span class="math inline">\(r=0\)</span> the solution is constant.</p>
<p>Malthusian growth in the continuous time model leads to either a constant population, exponentially increasing or exponentially decreasing growth. As was the case for the discrete time model, such a model could account for biological system only in particularly limited circumstances.</p>
</section>
</section>
</section>
<section id="tools-for-analysing-the-dynamics-of-a-single-population-in-continuous-time" class="level2">
<h2 class="anchored" data-anchor-id="tools-for-analysing-the-dynamics-of-a-single-population-in-continuous-time">Tools for analysing the dynamics of a single population in continuous time</h2>
<p>We again consider the general form for a single species model defined in continuous time. Let <span class="math inline">\(N=N(t)\)</span>.</p>
<p><span id="eq-gensinglespecodeagain"><span class="math display">\[
\frac{dN}{dt}=f(N)N=H(N)
\tag{2}\]</span></span></p>
<section id="numerical-solution" class="level3">
<h3 class="anchored" data-anchor-id="numerical-solution">Numerical solution</h3>
<p>Although an equation of the form <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> may not be explicitly integrable, so long as the right-hand side is sufficiently well behaved, we can numerically integrate the problem (e.g.&nbsp;using a package such as Maple’s <code>dsolve' or Matlab's</code>ode45’). Such a technique provides a numerical approximation to the exact solution, given specific values of model parameters and initial conditions (i.e.&nbsp;we can graph solutions).</p>
</section>
<section id="nondimensionalisation" class="level3">
<h3 class="anchored" data-anchor-id="nondimensionalisation">Nondimensionalisation</h3>
<p>We nondimensionalise a model by changing from variables that have dimensions (both dependent and independent) to variables that are dimensionless.</p>
</section>
<section id="dimensional-analysis" class="level3">
<h3 class="anchored" data-anchor-id="dimensional-analysis">Dimensional analysis</h3>
<p>The dimensions/units of each term in a model must be consistent. This observation helps to determine the units of different parameters in a model.</p>
<p>For example, we can deduce that the units of the parameter <span class="math inline">\(r\)</span> in the Malthusian model <span class="math display">\[
\frac{dN}{dt}=rN.
\]</span></p>
<p>The units of the left-hand term are <span class="math display">\[
\frac{\# pop density}{\# time}.
\]</span></p>
<p>The units of the term on the right-hand side are <span class="math display">\[
\#r\#popdensity.
\]</span></p>
<p>For dimensional consistency <span class="math display">\[
\#r = \frac{1}{\#time}.
\]</span></p>
</section>
<section id="defining-dimensionless-variables" class="level3">
<h3 class="anchored" data-anchor-id="defining-dimensionless-variables">Defining dimensionless variables</h3>
<p>We could nondimensionalise <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> by defining the dimensionless variables <span class="math display">\[
\begin{align}
n=\frac{N}{\tilde{N}} \nonumber \\
\tau=\frac{t}{\tilde{T}}.\nonumber
\end{align}
\]</span></p>
</section>
<section id="changing-variables" class="level3">
<h3 class="anchored" data-anchor-id="changing-variables">Changing variables</h3>
<p>Making the proposed change of variables in <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> we obtain the dimensionless model <span class="math display">\[
\frac{dn}{d\tau}= \frac{\tilde{T}}{\tilde{N}}H(\tilde{N}n(\tau)).
\]</span> The choice for scalings is in general not unique (i.e.&nbsp;<span class="math inline">\(N^*\)</span> and <span class="math inline">\(T^*\)</span>). Appropriate choices can result in fewer dimensionless parameters in the dimensionless model.</p>
<p>Exercise: Show that the Mathusian model <span class="math display">\[
\frac{dN}{dt}=rN
\]</span> can be written in nondimensional form <span class="math display">\[
\frac{dn}{d\tau}=n.
\]</span></p>
<p>Introducing dimensionless variable <span class="math display">\[
n=\frac{N}{\tilde{N}} \quad \tau=\frac{t}{\tilde{T}}
\]</span> yields <span class="math display">\[
\frac{dn}{d\tau}=r\tilde{T}n
\]</span> Choosing <span class="math display">\[
\tilde{T}=\frac{1}{r}
\]</span> yields <span class="math display">\[
\frac{dn}{d\tau}=n.
\]</span></p>
</section>
<section id="steady-state" class="level3">
<h3 class="anchored" data-anchor-id="steady-state">Steady-state</h3>
<p>We denote steady-state solutions of <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> using <span class="math inline">\(N=N^*\)</span>. At a steady-state, <span class="math display">\[
\frac{dN}{dt}=0
\]</span> and hence steady-states can be obtained by solving the algebraic equation <span class="math display">\[
H(N^*)=0.
\]</span></p>
<!--
We can compute the steady states of the Malthusian model
$$
\frac{dN}{dt}=rN.
$$

The steady states are $N^*=0$.
-->
</section>
<section id="linear-stability-analysis" class="level3">
<h3 class="anchored" data-anchor-id="linear-stability-analysis">Linear stability analysis</h3>
<section id="a-change-of-dependent-variable" class="level4">
<h4 class="anchored" data-anchor-id="a-change-of-dependent-variable">A change of dependent variable</h4>
<p>To perform a linear stability analysis we make the change of variables <span class="math display">\[
N(t)=N^*+\hat{N}(t)
\]</span> where the new dependent variable, <span class="math inline">\(\hat{N}(t)\)</span>, is a perturbation about the steady state.</p>
<p>The time derivative on the left-hand side of <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> transforms to <span class="math display">\[
\frac{dN}{dt}= \frac{d }{dt} (N^*) + \frac{d }{dt}(\hat{N}(t))=\frac{d\hat{N}(t) }{dt}.
\]</span> Hence <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> transforms to <span class="math display">\[
\frac{d\hat{N}(t) }{dt} = H(N^*+\hat{N}(t)).
\]</span></p>
</section>
<section id="taylor-expansion-and-a-linear-system" class="level4">
<h4 class="anchored" data-anchor-id="taylor-expansion-and-a-linear-system">Taylor expansion and a linear system</h4>
<p>Employing the Taylor expansion on the right-hand side of <a href="#eq-gensinglespecodeagain">Equation&nbsp;2</a> and making the assumption that perturbations are small <span class="math display">\[
\frac{d\hat{N}(t) }{dt} = H(N^*)+  H'(N^*)\hat{N}(t) + H''(N^*)\hat{N}^2(t) + h.o.t.
\]</span> Noting that<br>
<span class="math display">\[
H(N^*)=0
\]</span> and retaining linear terms yields <span class="math display">\[
\frac{d\hat{N}(t) }{dt} =  H'(N^*)\hat{N}(t)
\]</span> with solution <span class="math display">\[
\hat{N}(t)=  \eta e^{H'(N^*) t}
\]</span> where <span class="math inline">\(\eta\)</span> is some initial perturbation about the steady-state.</p>
</section>
</section>
<section id="a-condition-for-linear-stability" class="level3">
<h3 class="anchored" data-anchor-id="a-condition-for-linear-stability">A condition for linear stability</h3>
<p>When <span class="math inline">\(H'(N^*)&gt;0\)</span> the perturbation grows exponentially fast and the steady-state is unstable. \ When <span class="math inline">\(H'(N^*)&lt;0\)</span> the perturbation decays exponentially fast and the steady-state is stable.</p>

<!--
\examplequestion{Deduce the linear stability steady states of the Malthusian model
$$
\frac{dN}{dt}=rN.
$$
}
\stwritingexample{
In this case
$$
H'(N)=r
$$
Thus at steady state $N^*=0$
$$
H'(0)=r
$$
Hence for $r>0$, $N^*=0$ is linearly unstable. For $r<0$ $N^*=0$ is linearly stable. 
-->
</section>
<section id="graphical-solution" class="level3">
<h3 class="anchored" data-anchor-id="graphical-solution">Graphical solution</h3>
<p>We can graphically identify steady-states and their stability by plotting <span class="math inline">\(dN/dt\)</span> against <span class="math inline">\(N(t)\)</span>. Steady-states arise at the roots of <span class="math inline">\(H(N)\)</span>. The sign of the derivative at a root determines its linear stability.</p>
</section>
<section id="bifurcation-diagrams" class="level3">
<h3 class="anchored" data-anchor-id="bifurcation-diagrams">Bifurcation diagrams</h3>
<p>Bifurcations arise when the number of solutions or their stability changes at a given value of a model parameter. By plotting the steady state solutions against a model parameter and using annotation to represent stability of solutions we can obtain a bifurcation diagram.</p>
</section>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>As an exercise perform a qualitative analysis of the Malthusian model.</p>
<p>The Malthusian model (constant per capita growth rate) can exhibit a limited range of behaviour.</p>
<p>To account for limitation of population growth at large population densities due to, for example, limited resources, we consider nonlinear per capita growth rates.</p>
<section id="model-development" class="level3">
<h3 class="anchored" data-anchor-id="model-development">Model development</h3>
<p>Let <span class="math inline">\(N=N(t)\)</span>. The logistic model, due to Verhulst, takes the form <span id="eq-logisticode"><span class="math display">\[
\frac{dN}{dt}=rN(t)\left (1-\frac{N(t)}{K}\right),
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(r\)</span> is the linear growth rate and <span class="math inline">\(K\)</span> is carrying capacity. We consider both <span class="math inline">\(r,K\in \Re^+\)</span>.</p>
<p>Questions to ask of such a model are: what type of biologically realistic solutions does it possess? Are there steady-states? If so, are they stable or unstable? Are there bifurcations in solutions?</p>
</section>
<section id="an-exact-solution" class="level3">
<h3 class="anchored" data-anchor-id="an-exact-solution">An exact solution</h3>
<p>Separation of variables yields <span class="math display">\[
\int\frac{ dN}{N(1-\frac{N}{K})}=r\int dt.
\]</span> Using partial fractions <span class="math display">\[
\int\frac{ dN}{N} + \frac{1}{K}\int\frac{ dN}{1-\frac{N}{K}}=r\int dt.
\]</span> Integration yields <span class="math display">\[
\ln N - \ln\left(1-\frac{N}{K}\right)= \ln \frac{N }{1-\frac{N}{K}} =  rt+C.
\]</span> Hence <span class="math display">\[
N=\frac{De^{rt}}{1+\frac{D}{K}e^{rt}}
\]</span> Given an initial condition <span class="math inline">\(N(0)=N_0\)</span>, we obtain <span class="math display">\[
N(t)=\frac{N_0K e^{rt}}{K+N_0(e^{rt}-1)}
\]</span></p>
<section id="qualitative-analysis-of-the-exact-solution" class="level4">
<h4 class="anchored" data-anchor-id="qualitative-analysis-of-the-exact-solution">Qualitative analysis of the exact solution</h4>
<p>As <span class="math inline">\(t\rightarrow \infty\)</span>, <span class="math inline">\(N\rightarrow K\)</span>. At <span class="math inline">\(t=0\)</span>, <span class="math inline">\(N=N_0\)</span> and that for small <span class="math inline">\(N_0\ll K\)</span> the initial growth phase is exponential, i.e.&nbsp; <span class="math display">\[
N(t)\sim N_0 e^{rt} \\ \ \ \ \ N_0\ll K, t\ll \frac{1}{r}.
\]</span></p>
<p>Note that in almost all the models that we will consider the above method is not an usually an option as the ODE is not explicitly integrable.</p>
</section>
<section id="numerical-solutions" class="level4">
<h4 class="anchored" data-anchor-id="numerical-solutions">Numerical solutions</h4>
<p>In Figure <span class="math inline">\(\ref{LogisticODENt}\)</span> we present numerical solutions of equation using different initial conditions. Note the limiting behaviour of solutions as <span class="math inline">\(t\rightarrow \infty\)</span>. In Figure <span class="math inline">\(\ref{LogisticODENt}\)</span> it is clear that even though some solutions are initialised at <span class="math inline">\(N_0=0.1\)</span>, much closer to <span class="math inline">\(N^*=0\)</span> than <span class="math inline">\(N^*=K\)</span>, they tend to the limit <span class="math inline">\(N=K\)</span>. Why do solutions not tend to <span class="math inline">\(N^*=0\)</span>?</p>
</section>
<section id="dimensional-analysis-and-nondimensionalisation" class="level4">
<h4 class="anchored" data-anchor-id="dimensional-analysis-and-nondimensionalisation">Dimensional analysis and nondimensionalisation</h4>
<p><span class="math inline">\(N\)</span> represents the population density and has units of one over area (say <span class="math inline">\(1/m^2\)</span>) and <span class="math inline">\(t\)</span> has units of time (say, seconds, <span class="math inline">\(s\)</span>). Hence the left-hand side of <a href="#eq-logisticode">Equation&nbsp;3</a> has units of <span class="math inline">\(1/(m^2 s)\)</span>. The first term on the right-hand side of <a href="#eq-logisticode">Equation&nbsp;3</a> is <span class="math inline">\(rN\)</span>. <span class="math inline">\(N\)</span> has units <span class="math inline">\(1/m^2\)</span> hence the parameter <span class="math inline">\(r\)</span> must have units of <span class="math inline">\(1/s\)</span> for dimensional consistency. This is consistent as <span class="math inline">\(r\)</span> represents the linear growth rate.</p>
<p>The second term has the form <span class="math inline">\(rN^2/K\)</span>. Given the chosen units for <span class="math inline">\(r\)</span> and <span class="math inline">\(N\)</span>, the parameter <span class="math inline">\(K\)</span> must have dimensions <span class="math inline">\(1/m^2\)</span>. Again, this is consistent as <span class="math inline">\(K\)</span> is a carrying capacity (i.e.&nbsp;it has units of population density).</p>
<p>We define the nondimensionalised variables <span class="math display">\[
n=\frac{N}{\tilde{N}} \ \ \ \ \ \ \tau=\frac{t}{\tilde{T}}
\]</span> where <span class="math inline">\(\tilde{N}\)</span> and <span class="math inline">\(\tilde{T}\)</span> are constants that have units of population density and time, respectively. Hence <a href="#eq-logisticode">Equation&nbsp;3</a> transforms, upon change of variables, to <span class="math display">\[
\begin{align}
\frac{\tilde{N}}{\tilde{T} }\frac{dn}{d\tau}=r\tilde{N}n(1-\frac{n\tilde{N}}{K}).
\end{align}
\]</span></p>
<p>In the case of the logistic equation there is only one time scale and density scale in the problem, hence we choose <span class="math display">\[
\tilde{T}=\frac{1}{r}  \ \ \ and \ \ \ \tilde{N}=K
\]</span> and the dimensionless model is <span id="eq-logisticnondim"><span class="math display">\[
\begin{align}
\frac{dn}{d\tau}= n(1-n)
\end{align}
\tag{4}\]</span></span> Note that we can retrieve the original equation by rescaling and calculating <span class="math inline">\(N=\tilde{N}n\)</span> and <span class="math inline">\(t=\tilde{T}\tau\)</span>.</p>
</section>
</section>
<section id="steady-states-and-linear-stability" class="level3">
<h3 class="anchored" data-anchor-id="steady-states-and-linear-stability">Steady states and linear stability</h3>
<p>Steady states satisfy <span class="math display">\[
n^*(1-n^*)=0.
\]</span> Hence <span class="math display">\[
n^*=0, \ \ \ \ n^*=1.
\]</span></p>
<p>To determine linear stability we compute <span class="math display">\[
H'(n)= (1-2n).
\]</span> When <span class="math inline">\(n=n^*=0\)</span> we obtain <span class="math display">\[
H'(n)= 1.
\]</span> Hence the origin is an unstable steady-state.</p>
<p>At the steady-state <span class="math inline">\(n^*=1\)</span> <span class="math display">\[
H'(n^*)= -1
\]</span> hence <span class="math inline">\(n^*=1\)</span> is linearly stable.</p>
<p>Note that the linear stability analysis can explain the observations regarding the numeric solutions presented in Figure <span class="math inline">\(\ref{LogisticODENt}\)</span>.</p>
</section>
<section id="graphical-analysis" class="level3">
<h3 class="anchored" data-anchor-id="graphical-analysis">Graphical analysis</h3>
<p>In Figure <span class="math inline">\(\ref{LogisticODEfn}\)</span> we plot the right-hand side of <a href="#eq-logisticnondim">Equation&nbsp;4</a>. We can qualitatively describe model solutions by considering the arrow along the x axis. Suppose we consider an initial condition with <span class="math inline">\(0&lt;n_0&lt;1\)</span>. Using the graph of <span class="math inline">\(H(n)\)</span>, <span class="math inline">\(dn/d\tau\)</span> is positive, hence <span class="math inline">\(n\)</span> increases as a function of time until <span class="math inline">\(n(\tau)\rightarrow 1\)</span>.</p>
</section>
</section>
<section id="the-sprunce-budworm" class="level2">
<h2 class="anchored" data-anchor-id="the-sprunce-budworm">The sprunce budworm</h2>
<p>The spruce budworm is a destructive and widely distributed forest defoliator in North America. Massive outbreaks occur periodically and can destroy large quantities of valuable spruce and fir. To understand the outbreak behaviour and develop and management strategies, a series of mathematical models have been developed, beginning with Ludwig et al.&nbsp;(1978). The goal of the models is to explain the qualitative pattern of sudden outbreaks and then a sudden collapse.</p>
<section id="model-development-1" class="level3">
<h3 class="anchored" data-anchor-id="model-development-1">Model development</h3>
<p>Letting <span class="math inline">\(N(t)\)</span> represent the population size at time <span class="math inline">\(t\)</span>, it is assumed that budworm exhibits logistic growth and is subject to predation at rate <span class="math inline">\(p(N)\)</span>. A governing ordinary differential equation is given by <span id="eq-sprucebudworm"><span class="math display">\[
\frac{dN }{dt}= r_B N\left(1-\frac{N}{K_B}\right)-p(N),
\tag{5}\]</span></span> where <span class="math display">\[
p(N) =\frac{B N^2}{A^2 +N^2},
\]</span> <span class="math inline">\(r_B\)</span> is the linear growth rate, <span class="math inline">\(K_B\)</span> is the carrying capacity, <span class="math inline">\(B\)</span> is the maximum rate of predation and <span class="math inline">\(A\)</span> is a measure of budworm population where predation switches on (specifically, <span class="math inline">\(A\)</span> represents the budworm density at which predation is half its maximum value).</p>
<p>It is informative to graph the predation term <span class="math display">\[
p(N) =\frac{B N^2}{A^2 +N^2},
\]</span> and annotate the parameters <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>.</p>
<p>There is a root at <span class="math inline">\(N=0\)</span>. In the limit <span class="math inline">\(N\rightarrow \infty\)</span>, <span class="math inline">\(p \rightarrow B\)</span>. Note that <span class="math inline">\(N=A\)</span>, <span class="math inline">\(p=A/2\)</span>. The derivative is <span class="math display">\[
p'(N)=\frac{2BN}{A^2+N^2} - \frac{2BN^3}{(A^2+N^2)^2} =  \frac{2BA^2N}{(A^2+N^2)^2}
\]</span> Thus there is a turning point at <span class="math inline">\(N=0\)</span> and <span class="math inline">\(p'&gt;0 \forall N&gt;0\)</span>.</p>
</section>
<section id="nondimensionalisation-1" class="level3">
<h3 class="anchored" data-anchor-id="nondimensionalisation-1">Nondimensionalisation</h3>
<p>Introducing the (as yet unspecified) dimensional scalings <span class="math inline">\(\tilde{N}\)</span> and <span class="math inline">\(\tilde{T}\)</span>, the model is nondimensionalised as follows</p>
<p><span class="math display">\[
n=\frac{N}{\tilde{N}} \ \ \ \ \ \ \tau=\frac{t}{\tilde{T}}.
\]</span></p>
<p>Changing variables in <a href="#eq-sprucebudworm">Equation&nbsp;5</a> yields</p>
<p><span class="math display">\[
\frac{\tilde{N}}{\tilde{T}}\frac{d n }{d\tau}= r_B \tilde{N}n\left(1-\frac{\tilde{N}n}{K_B}\right)-\frac{B\tilde{N}^2n^2}{A^2+\tilde{N}^2 n^2}.
\]</span></p>
<p>After some tidying</p>
<p><span class="math display">\[
\frac{dn }{d\tau}= r_B\tilde{T} n\left(1-\frac{\tilde{N}n}{K_B}\right)-\frac{B\tilde{N} \tilde{T}}{A^2}\frac{n^2}{1+\frac{\tilde{N}^2}{A^2}n^2}.
\]</span></p>
<p>A natural scale for cell density in the model is given by the parameter <span class="math inline">\(A\)</span>, as it determines the density of budworm at which predation is half its maximal value. Hence we choose the scaling on the budworm density <span class="math display">\[
\tilde{N}=A.
\]</span> Similarly, a natural time scale for the model is given by<br>
<span class="math display">\[
\tilde{T}=A/B.
\]</span></p>
<p>Substituting for <span class="math inline">\(\tilde{N}\)</span> and <span class="math inline">\(\tilde{T}\)</span> yields <span id="eq-budwormnondim"><span class="math display">\[
\frac{dn }{d\tau}= rn\left(1-\frac{n}{q}\right)-\frac{n^2}{1+n^2} = H(n),
\tag{6}\]</span></span> where we define the nondimensional parameters <span class="math display">\[
r= \frac{r_B A}{B} \ \ \  \textrm{and} \ \ \  q=\frac{K_B}{A}.
\]</span></p>
<p>Note that <a href="#eq-budwormnondim">Equation&nbsp;6</a> has two nondimensional parameters and all variables are dimensionless.</p>
</section>
<section id="numerical-solutions-1" class="level3">
<h3 class="anchored" data-anchor-id="numerical-solutions-1">Numerical solutions</h3>
<p>In Figure <span class="math inline">\(\ref{SpruceBudwormNtBehaviours}\)</span> we plot some numerical solutions of <a href="#eq-budwormnondim">Equation&nbsp;6</a> at different values of the parameter <span class="math inline">\(r\)</span>.</p>
<p>Numerical solutions of <a href="#eq-budwormnondim">Equation&nbsp;6</a> indicate that there is a single stable steady state when <span class="math inline">\(r\)</span> is both small and large but for intermediate values of <span class="math inline">\(r\)</span> there are two stable steady states.</p>
<p>Our goal is to analyse the model and understand why different parameter values yield these strikingly different model behaviours.</p>
</section>
<section id="steady-states" class="level3">
<h3 class="anchored" data-anchor-id="steady-states">Steady states</h3>
<p>Letting <span class="math inline">\(n^*\)</span> represent steady states of <a href="#eq-budwormnondim">Equation&nbsp;6</a> yields <span class="math display">\[
rn^*(1-\frac{n^*}{q})- \frac{n^*{^2}}{1+n^*{^2}}=0.
\]</span> Hence either <span class="math display">\[
n^*=0,
\]</span> or <span class="math inline">\(n^*\)</span> satisfies the cubic equation <span class="math display">\[
r\left(1-\frac{n^*}{q}\right)- \frac{n^*}{1+n^*{^2}}=0.
\]</span></p>
<p>Explicit solutions to such a cubic can be immediately written down but they are cumbersome to work with. %We proceed using a graphical/qualitative approach.</p>
<p>Define <span id="eq-sprucebudwormfgn"><span class="math display">\[
f(n^*)=r\left(1-\frac{n^*}{q}\right) \ \ \textrm{and} \ \ g(n^*)=\frac{n^*}{1+n^*{^2}}.
\tag{7}\]</span></span></p>
<p>Roots occur for values of <span class="math inline">\(n^*\)</span> that satisfy <span class="math inline">\(f=g\)</span>.</p>
<p>In Figure <span class="math inline">\(\ref{SpruceBudwormHn}\)</span> (a) we fix the parameter <span class="math inline">\(q=10\)</span> and consider model behaviour as a function of the parameter <span class="math inline">\(r\)</span>. When <span class="math inline">\(r\gg1\)</span> there is a nonzero steady-state corresponding to <span class="math inline">\(n^*\gg 1\)</span>. When <span class="math inline">\(r\ll1\)</span> there is a nonzero steady-state corresponding to <span class="math inline">\(n^*\ll 1\)</span>. In the intermediate case there can be three intersection points.</p>
<p>We can use the curve sketching techniques form Tutorial Sheet 1 to sketch <span class="math inline">\(f\)</span> and <span class="math inline">\(g\)</span>.</p>
<p><span class="math inline">\(f\)</span> is linear. There is a root at <span class="math inline">\(n^*=q\)</span>. The derivative is <span class="math inline">\(-r/q\)</span>. <span class="math inline">\(f(0)\)</span>=r. <span class="math inline">\(g\)</span> has a unique root at <span class="math inline">\(n^*=0\)</span>. The derivative is <span class="math display">\[
g'=\frac{1-n{^*}^2}{(1+n^*)^2}.
\]</span> There is a turning point at <span class="math inline">\(n^*=1\)</span>. Here <span class="math inline">\(g=1/2\)</span>. As <span class="math inline">\(n^*\rightarrow \infty\)</span>, <span class="math inline">\(g\rightarrow 0\)</span>. <span class="math inline">\(f'(0)=1\)</span>.</p>
</section>
<section id="linear-stability-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="linear-stability-analysis-1">Linear stability analysis</h3>
<p>The linear stability of the model is determined by the quantity <span class="math display">\[
H'(n)=r(1-\frac{2n}{q})-\frac{2{n}}{1+{n}^2} +\frac{2{n}^3}{(1+{n}^2)^2}.
\]</span></p>
<p>Hence at the steady state <span class="math inline">\(n^*=0\)</span> <span class="math display">\[
H'(0)=r
\]</span> and the steady state is linearly unstable.</p>
<p>Given the nonzero steady states have not been calculated explicitly, we proceed using graphical analysis of stability. In Figure <span class="math inline">\(\ref{SpruceBudwormHn}\)</span> (b) we plot the right-hand side of <a href="#eq-budwormnondim">Equation&nbsp;6</a> against <span class="math inline">\(n\)</span> and examine the cases of large, small and intermediate <span class="math inline">\(r\)</span> for a given value of <span class="math inline">\(q\)</span>.</p>
<p>When <span class="math inline">\(r\)</span> is both large and small the nonzero steady state is stable (the derivative at the roots is negative). In the case where three biologically relevant roots exist, the intermediate root is unstable.</p>
<section id="bifurcation-analysis" class="level4">
<h4 class="anchored" data-anchor-id="bifurcation-analysis">Bifurcation analysis</h4>
<p>The goal is to identify boundaries of <span class="math inline">\(rq\)</span> parameter space where the stability changes occur and/or the number of steady states changes.</p>
<p>We can define points in <span class="math inline">\(rq\)</span> parameter space where bifurcations arise by seeking values of <span class="math inline">\(n^*\)</span> that satisfy <span class="math display">\[
f(n^*)= g(n^*) \ \ \ \  f'(n^*)= g'(n^*).
\]</span></p>
<p>The first of these equations yields <span id="eq-rqeqn1"><span class="math display">\[
  r(1-\frac{n^*}{q}) = \frac{n^*}{1+n{^*}^{2}},
\tag{8}\]</span></span> and the latter yields <span id="eq-rqeqn2"><span class="math display">\[
-\frac{r}{q}=\frac{1}{1+n{^*}^{2}}-\frac{2n{^*}^{2}}{(1+n{^*})^2} = \frac{1-n{^*}^{2}}{(1+n{^*}^{2})^2}.
\tag{9}\]</span></span></p>
<p>Hence <span class="math display">\[
   \frac{r}{q}= \frac{n{^*}^{2}-1}{(1+n{^*}^{2})^2}.
\]</span></p>
<p>Substituting for <span class="math inline">\(r/q\)</span> in the first equation yields <span class="math display">\[
r-\frac{n{^*}^{2}-1}{(1+n{^*}^{2})^2}n^*=\frac{n^*}{1+n{^*}^{2}},
\]</span> which can be written in the form <span class="math display">\[
r=\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}.
\]</span> Substituting for <span class="math inline">\(r\)</span> in <a href="#eq-rqeqn1">Equation&nbsp;8</a> yields <span class="math display">\[
\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}=\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}\frac{n^*}{q}+\frac{n^*}{1+n{^*}^2}
\]</span> which, after some algebra, yields <span id="eq-sprucebudwormqpara"><span class="math display">\[
q=\frac{2n{^*}^3}{n{^*}^{2}-1}.
\tag{10}\]</span></span> Hence a set of points that define bifurcations where three steady states transform to a single steady state are given in parametric form in <span class="math inline">\(qr\)</span> parameter space by <span class="math display">\[
\left(\frac{2n{^*}^3}{n{^*}^{2}-1},\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2}\right) \ \ \ \ \ \ \ n^*&gt;1.
\]</span></p>
<p>By varying values of <span class="math inline">\(n^*\)</span> in Figure <span class="math inline">\(\ref{SpruceBudwormqrspace}\)</span> we plot a region of instability. Note for example that <span class="math inline">\(q\rightarrow \infty\)</span> as <span class="math inline">\(n^*\rightarrow 1\)</span> and as <span class="math inline">\(n^*\rightarrow \infty\)</span>. Note also that in these limits <span class="math inline">\(r\)</span> must take the value 1/2 and 0, respectively.</p>
<p>We can show that the cusp in Figure <span class="math inline">\(\ref{SpruceBudwormqrspace}\)</span> is given by <span class="math display">\[
\left(q,r\right)=\left(3^{\frac{3}{2}},\left(\frac{\sqrt{3}}{2}\right)^3\right).
\]</span></p>
<p>Note that <span class="math inline">\(r\)</span> is a decreasing function of <span class="math inline">\(q\)</span> for <span class="math inline">\(1&lt;n^*&lt;\sqrt{3}\)</span> but that <span class="math inline">\(r\)</span> is an increasing function of <span class="math inline">\(n^*\)</span> for <span class="math inline">\(\sqrt{3}&lt;n^*&lt;\infty\)</span>. This can be shown by finding the turning points of <span class="math inline">\(r\)</span> w.r.t <span class="math inline">\(n^*\)</span>, i.e. Given that <span class="math display">\[
r=\frac{2n{^*}^{3}}{(1+n{^*}^{2})^2},
\]</span> differentiation with respect to <span class="math inline">\(n^*\)</span> yields <span class="math display">\[
\frac{dr}{dn^*}=\frac{6{n^*}^2}{(1+n^*)^2} - \frac{8n{^*}^4}{(1+n^*)^3}.
\]</span> The turning point satisfies <span class="math display">\[
\frac{6{n^*}^2}{(1+n^*)^2} - \frac{8n{^*}^4}{(1+n^*)^3}=0
\]</span> Solving for <span class="math inline">\(n^*\)</span> yields <span class="math display">\[
6(1+{n^*}^2) - 8n{^*}^2=0
\]</span> Hence <span class="math display">\[
  n^*=\sqrt{3}.
\]</span> Thus there is a turning point that minimises <span class="math inline">\(r\)</span> at <span class="math inline">\(n^*=\sqrt{3}\)</span>.</p>
<p>Substitution for this value of <span class="math inline">\(n^*\)</span> yields <span class="math display">\[
\left(q,r\right)=\left(3^{\frac{3}{2}},\left(\frac{\sqrt{3}}{2}\right)^3\right).
\]</span> See Figure <span class="math inline">\(\ref{SpruceBudwormqrspace}\)</span>.</p>
</section>
</section>
<section id="exhibiting-hysteresis-using-a-bifurcation-diagram" class="level3">
<h3 class="anchored" data-anchor-id="exhibiting-hysteresis-using-a-bifurcation-diagram">Exhibiting hysteresis using a bifurcation diagram</h3>
<p>Finally, rearranging the steady-state equation <span class="math display">\[
  r(1-\frac{n^*}{q}) = \frac{n^*}{1+n{^*}^{2}},
\]</span> we obtain <span id="eq-sprucebudwormrpara"><span class="math display">\[
   r = \frac{n^*}{(1+n{^*}^{2})(1-\frac{n^*}{q})}.
\tag{11}\]</span></span></p>
<p>Considering <span class="math inline">\(n^*&lt;q\)</span> we compute <span class="math inline">\(r\)</span>; plotting <span class="math inline">\(n^*\)</span> against <span class="math inline">\(r\)</span> yields the bifurcation curve presented in Figure <span class="math inline">\(\ref{SpruceBudwormrn_star}\)</span>.</p>
<p>In Figure <span class="math inline">\(\ref{SpruceBudwormHncrit}\)</span> we plot the right-hand side of equation <span class="math inline">\(\eqref{budwormnondim}\)</span> at the bifurcation values. Note that for the plotted values of <span class="math inline">\(r\)</span> there is a double root of <span class="math inline">\(H(n)\)</span>.</p>
<p>A system exhibiting hysteresis shows a response to an increases in a control parameter that is not exactly reversed when the parameter is decreased. We can show that the spruce budworm model exhibits hysteresis by considering the argument below.</p>
<p>Suppose <span class="math inline">\(r\)</span> is initially small (<span class="math inline">\(r&lt;r_1\)</span>). There is only one steady-state and any initial condition will converge towards it.</p>
<p>Suppose we increase the value of the parameter <span class="math inline">\(r\)</span>. There will be a critical value of <span class="math inline">\(r\)</span> (<span class="math inline">\(r=r_1\)</span>)where a second stable steady-state arises and the model enters the bistable regime, where there are two possible stable steady-states. Given the system system was originally in the first stable steady state, it will remain there.</p>
<p>Suppose we continue to increase <span class="math inline">\(r\)</span>. Eventually we reach critical value of <span class="math inline">\(r\)</span> (<span class="math inline">\(r=r_2\)</span>) where the first stable steady state is lost and there is again only one stable steady-state.</p>
<p>Suppose we now decrease the parameter <span class="math inline">\(r\)</span> below the threshold <span class="math inline">\(r=r_2\)</span>. The system again enters the bistable regime but as the second solution is stable, it remains the solution.</p>
<p>Suppose we continue to decrease <span class="math inline">\(r\)</span> until eventually <span class="math inline">\(r&lt;r_1\)</span>. We return to the case where the system has only a single stable steady state.</p>
</section>
</section>
<section id="harvesting" class="level2">
<h2 class="anchored" data-anchor-id="harvesting">Harvesting</h2>
<p>By introducing terms that represent harvesting, population models can be used to investigate management strategies for resource management. The modelling problem is to maximise the sustained yield.</p>
<p>Consider a model for logistic growth supplemented with a harvesting term <span class="math display">\[
\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right) -EN.
\]</span> The term <span class="math inline">\(EN\)</span> is the harvesting yield per unit time and the constant <span class="math inline">\(E\)</span> represents the harvesting effort.</p>
<p>Steady states satisfy <span class="math display">\[
rN^*\left(1-\frac{N^*}{K}\right) -EN^*=0
\]</span> Thus either <span class="math inline">\(N^*=0\)</span> or <span class="math display">\[
\left(1-\frac{N^*}{K}\right) -E=0
\]</span> Hence <span class="math display">\[
N^*=K(1-\frac{E}{r}).
\]</span> Note that this is positive only if <span class="math display">\[
E&lt;r.
\]</span> Thus if the harvesting rate exceeds the linear growth rate the only steady state corresponds to extinction.</p>
<p>The yield is <span class="math display">\[
Y(E)=EN^*=EK(1-\frac{E}{r})
\]</span></p>
<p>To maximise the yields we differentiate with respect to <span class="math inline">\(E\)</span>. <span class="math display">\[
\frac{dY}{dE} = K - 2\frac{EK}{r}.
\]</span> Thus the maximum yield is identified by setting <span class="math display">\[
\frac{dY}{dE} = K - 2\frac{EK}{r}=0.
\]</span> THe maximum occurs at harvesting rate <span class="math display">\[
E_c=\frac{r}{2}.
\]</span> The maximum yield is <span class="math display">\[
E^*=\frac{rK}{4}.
\]</span></p>
<p>We identify the time scale over which stocks return to steady state by linearising about the steady state <span class="math inline">\(N^*=K(1-E/r)\)</span>, hence <span class="math display">\[
\frac{d \hat{N}}{dt} = (E-r)\hat{N}.
\]</span> Hence the recovery time scale is <span class="math display">\[
T_R(E)=O(\frac{1}{r-E}).
\]</span> As the harvesting rate approaches the linear growth rate <span class="math inline">\(r\)</span>, not only does the steady state population tend to zero but the timescale for stocks to recover tends to infinity. }</p>
<section id="delay-differential-equation-models" class="level3">
<h3 class="anchored" data-anchor-id="delay-differential-equation-models">Delay differential equation models</h3>
<p>Consider a model of the form <span class="math display">\[
\frac{dN}{dt}=H(N(t),N(t-T)),
\]</span> such that the right-hand side now depends on the value <span class="math inline">\(N\)</span> not just at time <span class="math inline">\(t\)</span> but also at some delay time <span class="math inline">\(t-T\)</span>. We now need to prescribe initial conditions of the form <span class="math display">\[
N(t)=f(t), \quad -T&lt;t\leq0.
\]</span></p>
<p>Consider a simple case of a linear model <span class="math display">\[
\frac{dN}{dt}=-N(t-T).
\]</span> A steady state, <span class="math inline">\(N^*\)</span>, is defined such that <span class="math inline">\(N(t)=N(t-T)=N^*\)</span>. Hence <span class="math display">\[
0=-kN^*.
\]</span> The only steady state is <span class="math inline">\(N^*=0\)</span>.</p>
<p>To compute the linear stability we consider solution of the linearised equation of the form <span class="math display">\[
N(t)=e^{\lambda t}.
\]</span> Hence <span class="math display">\[
N(t-T)=e^{\lambda (t-T)}.
\]</span></p>
<p>Substitution yields <span class="math display">\[
\lambda  e^{\lambda t} = - e^{\lambda (t-T)}.
\]</span> Hence the eigenvalue, <span class="math inline">\(\lambda\)</span>, satisfies a transcendental equation <span class="math display">\[
\lambda=-e^{\lambda -T}.
\]</span> This equation has no solutions for <span class="math inline">\(\lambda \in \Re\)</span>.</p>
<p>Consider solutions <span class="math inline">\(\lambda \in \mathbb{C}\)</span>. Let <span class="math inline">\(\lambda=\mu+i\omega\)</span>. Substitution yields <span class="math display">\[
\mu+i\omega = -e^{-\mu T}(\cos(\omega T)-i \sin(\omega T)).
\]</span> Hence <span class="math display">\[
\begin{align}
\mu=-\cos(\omega T)e^{-\mu T} \\
\omega = \sin(\omega T)e^{-\mu T}.
\end{align}
\]</span> For linear stability we require that <span class="math inline">\(\mu &lt;0\)</span>. This implies that <span class="math display">\[
-\frac{\pi}{2}&lt;\omega T &lt; \frac{\pi}{2}.
\]</span></p>
<p>Consider <span class="math display">\[
\frac{e^{\mu T}}{T}=\frac{\omega e^{\mu T}}{\omega T} = \frac{\sin(\omega T)}{\omega T}
\]</span></p>
<p>Noting that <span class="math display">\[
\frac{\sin z}{z} &gt; \frac{1}{\frac{\pi}{2}}
\]</span> yields <span class="math display">\[
\frac{\sin(\omega T)}{\omega T}&gt;\frac{2}{\pi}.
\]</span> Hence <span class="math display">\[
\frac{e^{\mu T}}{T} &gt;\frac{2}{\pi}.
\]</span> Rearranging <span class="math display">\[
T&lt;\frac{\pi}{2}e^{\mu T}.
\]</span> For linear stability <span class="math inline">\(\mu&lt;0\)</span>. Hence a necessary condition for linear stability is that <span class="math display">\[
T&lt;\frac{\pi}{2}
\]</span></p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>